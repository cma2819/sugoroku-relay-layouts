{"version":3,"file":"index.js","sources":["../src/extension/timer.ts","../src/extension/index.ts"],"sourcesContent":["import { NodeCG } from \"./nodecg\";\r\n\r\ntype TimerProps = {\r\n  start: Date;\r\n  end: Date;\r\n};\r\n\r\nexport const Timer = (props: TimerProps) => {\r\n  const startAtTimestamp = isNaN(props.start.getTime())\r\n    ? 0\r\n    : props.start.getTime();\r\n  const endAtTimestamp = isNaN(props.end.getTime())\r\n    ? Infinity\r\n    : props.end.getTime();\r\n  const timeLength = Math.max(0, endAtTimestamp - startAtTimestamp);\r\n\r\n  let currentTimeInSeconds = 0;\r\n\r\n  const getTimestamps = () => ({\r\n    start: startAtTimestamp,\r\n    end: endAtTimestamp,\r\n  });\r\n\r\n  const tick = (now: Date) => {\r\n    const timestamp = now.getTime();\r\n    const progress = Math.max(0, timestamp - startAtTimestamp);\r\n\r\n    const currentInMs = progress;\r\n\r\n    currentTimeInSeconds = Math.floor(currentInMs / 1000);\r\n  };\r\n\r\n  const getCurrentTimeInSeconds = () => {\r\n    return currentTimeInSeconds;\r\n  };\r\n\r\n  const formatTimeText = (time: number) => {\r\n    const showMinus = time < 0;\r\n    const currentTimeAbs = Math.abs(time);\r\n    const hours = Math.floor(currentTimeAbs / 3600);\r\n    const minutes = Math.floor((currentTimeAbs % 3600) / 60);\r\n    const seconds = Math.floor(currentTimeAbs % 60);\r\n\r\n    return (\r\n      (showMinus ? \"-\" : \"\") +\r\n      [\r\n        hours > 0 ? String(hours) : null,\r\n        String(minutes).padStart(2, \"0\"),\r\n        String(seconds).padStart(2, \"0\"),\r\n      ]\r\n        .filter((v): v is string => v !== null)\r\n        .join(\":\")\r\n    );\r\n  };\r\n\r\n  const getDisplayTime = () => {\r\n    return {\r\n      up: formatTimeText(currentTimeInSeconds),\r\n      down: formatTimeText(\r\n        Math.floor(timeLength / 1000) - currentTimeInSeconds\r\n      ),\r\n    };\r\n  };\r\n\r\n  return {\r\n    getTimestamps,\r\n    tick,\r\n    getCurrentTimeInSeconds,\r\n    getDisplayTime,\r\n  };\r\n};\r\n\r\nconst timer = (nodecg: NodeCG) => {\r\n  let timer: ReturnType<typeof Timer>;\r\n\r\n  const defaultSchedule = nodecg.bundleConfig.defaultSchedule;\r\n\r\n  const timerInputsRep = nodecg.Replicant(\"timerInputs\", {\r\n    defaultValue: {\r\n      startAt: defaultSchedule?.start ?? new Date(0).toISOString(),\r\n      endAt: defaultSchedule?.end ?? new Date(Infinity).toISOString(),\r\n    },\r\n  });\r\n  const timerRep = nodecg.Replicant(\"timer\", {\r\n    defaultValue: {\r\n      startAtTimestamp: 0,\r\n      endAtTimestamp: 0,\r\n      timeInSeconds: 0,\r\n      timeDisplayText: {\r\n        up: \"00:00\",\r\n        down: \"00:00\",\r\n      },\r\n    },\r\n  });\r\n  const statusRep = nodecg.Replicant(\"status\", { defaultValue: \"play\" });\r\n\r\n  timerInputsRep.on(\"change\", (newVal) => {\r\n    timer = Timer({\r\n      start: new Date(Date.parse(newVal.startAt)),\r\n      end: new Date(Date.parse(newVal.endAt)),\r\n    });\r\n  });\r\n\r\n  setInterval(() => {\r\n    if (!statusRep.value) {\r\n      return;\r\n    }\r\n\r\n    if (timer && statusRep.value === \"play\") {\r\n      timer.tick(new Date());\r\n\r\n      const timestamps = timer.getTimestamps();\r\n\r\n      timerRep.value = {\r\n        startAtTimestamp: timestamps.start,\r\n        endAtTimestamp: timestamps.end,\r\n        timeInSeconds: timer.getCurrentTimeInSeconds(),\r\n        timeDisplayText: timer.getDisplayTime(),\r\n      };\r\n    }\r\n  }, 100);\r\n};\r\n\r\nexport default timer;\r\n","import { NodeCG } from './nodecg';\r\nimport timer from './timer';\r\n\r\nexport default (nodecg: NodeCG) => {\r\n  timer(nodecg);\r\n};"],"names":["timer"],"mappings":"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"}